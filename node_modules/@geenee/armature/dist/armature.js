import{EventEmitter as K}from'events';class S extends K{}var t=Object['defineProperty'],W=Object['getOwnPropertySymbols'],c=Object['prototype']['hasOwnProperty'],b=Object['prototype']['propertyIsEnumerable'],s=(Vj,VA,Vm)=>VA in Vj?t(Vj,VA,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':Vm}):Vj[VA]=Vm,l=(Vj,VA)=>{for(var Vm in VA||(VA={}))c['call'](VA,Vm)&&s(Vj,Vm,VA[Vm]);if(W){for(var Vm of W(VA))b['call'](VA,Vm)&&s(Vj,Vm,VA[Vm]);}return Vj;};class a{constructor(Vj='canvas'){this['size']={'width':0x0,'height':0x0},this['context']=null,this['canvas']=document['createElement']('canvas'),this['canvas']['id']='engeenee.capture.'+Vj,this['canvas']['hidden']=!0x0,this['context']=this['canvas']['getContext']('2d',{'alpha':!0x1});}['capture'](Vj){const {context:VA}=this;if(!VA)return!0x1;const {width:Vm,height:VL}=this['size'];return VA['drawImage'](Vj,0x0,0x0,Vm,VL),!0x0;}['data'](){const {context:Vj}=this;if(!Vj)return;const {width:VA,height:Vm}=this['size'];return Vj['getImageData'](0x0,0x0,VA,Vm);}['setSize'](Vj){this['size']=l({},Vj),this['canvas']['width']=Vj['width'],this['canvas']['height']=Vj['height'];}['fill'](){const {context:Vj}=this;!Vj||(Vj['fillStyle']='rgba(255,\x20255,\x20255,\x201)',Vj['fillRect'](0x0,0x0,this['size']['width'],this['size']['height']));}['dispose'](){this['context']=null,this['canvas']['remove']();}}class k extends S{constructor(){super(),this['buffer']=new a('capture'),this['captureTime']=0x0;}async['setup'](Vj){const VA=Vj&&(Vm=>typeof Vm!='string'&&'size'in Vm)(Vj)&&Vj['size']||{'width':0x780,'height':0x438};return this['updateSize'](VA),this['buffer']['fill'](),!0x0;}['dispose'](){this['reset'](),this['buffer']['dispose']();}async['start'](){this['captureTime']=0x0,this['timer']=Date['now']();}['pause'](){}['reset'](){this['pause'](),delete this['timer'];}['capture'](){return this['timer']===void 0x0?!0x1:(this['captureTime']=(Date['now']()-this['timer'])*0x3e8,!0x0);}['size'](){return l({},this['buffer']['size']);}['ratio'](){const Vj=this['buffer']['size'];return Vj['width']/Vj['height'];}['updateSize'](Vj){this['buffer']['setSize'](Vj),this['emit']('resize',this['buffer']['size']);}}class w extends k{constructor(){super(),this['timeShift']=0x0,this['videoRef']=document['createElement']('video'),this['videoRef']['id']='engeenee.capture.source',this['videoRef']['muted']=!0x0,this['videoRef']['loop']=!0x0,this['videoRef']['playsInline']=!0x0;}async['setup'](Vj){const VA=VX=>typeof VX=='string'||'getVideoTracks'in VX,Vm=VX=>'video'in VX,VL=VX=>{if(!VX)return{'video':!0x0,'audio':!0x1};if(Vm(VX))return VX;const VD=VX['size'];return{'video':{'facingMode':VX['rear']?'environment':'user','width':VD==null?void 0x0:VD['width'],'height':VD==null?void 0x0:VD['height']},'audio':!0x1};},Vn=Vj!==void 0x0&&VA(Vj)?Vj:await navigator['mediaDevices']['getUserMedia'](VL(Vj))['catch'](()=>{});if(!Vn)return!0x1;const {videoRef:Vu}=this;return new Promise(VX=>{Vu['onloadedmetadata']=()=>{this['updateSize']({'width':Vu['videoWidth'],'height':Vu['videoHeight']}),Vu['onresize']=()=>{this['updateSize']({'width':Vu['videoWidth'],'height':Vu['videoHeight']});},Vu['onseeked']=()=>{this['timeShift']=this['captureTime'],this['captureTime']=0x0;},VX(!0x0);},typeof Vn=='string'?Vu['src']=Vn:Vu['srcObject']=Vn;});}['dispose'](){super['dispose'](),this['videoRef']['remove']();}async['start'](){this['captureTime']=0x0,this['timeShift']=0x0,(this['videoRef']['srcObject']||this['videoRef']['src'])&&await this['videoRef']['play']();}['pause'](){this['videoRef']['pause']();}['reset'](){this['pause'](),this['videoRef']['srcObject']&&(this['videoRef']['srcObject']['getTracks']()['forEach'](Vj=>Vj['stop']()),this['videoRef']['srcObject']=null);}['capture'](){const {videoRef:Vj,buffer:VA}=this,Vm=Vj['currentTime']+this['timeShift'];return Vm<=this['captureTime']?!0x1:(this['captureTime']=Vm,VA['capture'](Vj));}}class n extends S{constructor(Vj,VA,Vm=w){super(),this['engineParams']=VA,this['renderers']=[],this['videoRatio']=0x780/0x438,this['streamSize']={'width':0x780,'height':0x438},this['processSize']={'width':0x780,'height':0x438},this['resizeEnabled']=!0x1,this['loopState']=!0x1,this['init']=async VL=>{const Vn=await this['setupProcessor'](VL);return this['emit']('init',Vn),Vn;},this['setup']=async VL=>{this['pause']();const Vn=await this['setupVideo'](VL);return this['emit']('setup',Vn),Vn;},this['start']=async()=>{await this['video']['start'](),this['loopState']=!0x0,this['emit']('start'),this['enqueue']();},this['pause']=()=>{this['loopState']=!0x1,this['loopId']&&(window['cancelAnimationFrame'](this['loopId']),delete this['loopId']),this['video']['pause'](),this['emit']('pause');},this['reset']=()=>{this['pause'](),this['video']['reset'](),delete this['streamCanvas'],delete this['processCanvas'],this['processor']['reset']();},this['iterate']=async()=>{var VL;const {video:Vn,streamCanvas:Vu,processCanvas:VX}=this;if(!Vn['capture']()||!Vu||!VX)return this['enqueue']();this['resizeEnabled']&&((VL=this['resizeBuffer'])==null||VL['capture'](Vn['buffer']['canvas']));const VD=await this['processor']['process'](VX,Vn['captureTime']);VD&&await Promise['all'](this['renderers']['map'](Vh=>Vh['update'](VD,Vu))),this['enqueue']();},this['processor']=new Vj(),this['video']=new Vm(),this['video']['on']('resize',this['resizeVideo']['bind'](this));}async['addRenderer'](Vj){this['renderers']['push'](Vj),await Vj['load'](),Vj['setupVideo'](this['video']['size'](),this['video']['ratio']()),Vj['setupCamera'](this['processor']['cameraRatio'],this['processor']['cameraAngle']);}['removeRenderer'](Vj){const {renderers:VA}=this,Vm=VA['indexOf'](Vj);Vm<0x0||(VA[Vm]['dispose'](),VA['slice'](Vm,0x1));}['enqueue'](){this['loopId']=this['loopState']?window['requestAnimationFrame'](this['iterate']):void 0x0;}async['setupProcessor'](Vj){var VA;const Vm=this['resizeEnabled']&&((VA=this['resizeBuffer'])==null?void 0x0:VA['size'])||this['video']['size']();return this['processor']['init'](Vj,Vm,this['video']['ratio']());}async['setupVideo'](Vj){return this['video']['reset'](),await this['video']['setup'](Vj)?(this['setupSize'](this['video']['size']()),!0x0):!0x1;}async['setupSize'](Vj){var VA,Vm;const {width:VL,height:Vn}=Vj;this['videoRatio']=VL/Vn;const Vu=Math['max'](VL,Vn),VX=((VA=this['engineParams'])==null?void 0x0:VA['max'])||this['processor']['optimalSize'];if(this['resizeEnabled']=!0x1,VX<Vu){this['resizeEnabled']=!0x0;const VD=Vu/VX;this['resizeBuffer']||(this['resizeBuffer']=new a('resize')),this['resizeBuffer']['setSize']({'width':VL/VD,'height':Vn/VD});}this['resizeEnabled']&&this['resizeBuffer']?(this['processCanvas']=this['resizeBuffer']['canvas'],this['processSize']=this['resizeBuffer']['size']):(this['processCanvas']=this['video']['buffer']['canvas'],this['processSize']=this['video']['size']()),((Vm=this['engineParams'])==null?void 0x0:Vm['orig'])!==!0x1?(this['streamCanvas']=this['video']['buffer']['canvas'],this['streamSize']=this['video']['size']()):(this['streamCanvas']=this['processCanvas'],this['streamSize']=this['streamSize']);}['resizeVideo'](Vj){this['setupSize'](Vj),this['processor']['setupVideo'](this['processSize'],this['videoRatio']),this['renderers']['forEach'](VA=>VA['setupVideo'](this['streamSize'],this['videoRatio'])),this['renderers']['forEach'](VA=>VA['setupCamera'](this['processor']['cameraRatio'],this['processor']['cameraAngle']));}}class h extends n{constructor(){super(...arguments),this['iterate']=async()=>{var Vj;const {video:VA,streamCanvas:Vm,processCanvas:VL}=this;if(!Vm||!VL)return this['enqueue']();const Vn=this['result']&&await this['result'];if(Vn!==void 0x0&&await Promise['all'](this['renderers']['map'](Vu=>Vu['update'](Vn,Vm))),!VA['capture']())return delete this['result'],this['enqueue']();this['resizeEnabled']&&((Vj=this['resizeBuffer'])==null||Vj['capture'](VA['buffer']['canvas'])),this['result']=this['processor']['process'](VL,VA['captureTime']),this['enqueue']();};}}var q=Object['defineProperty'],x=Object['getOwnPropertySymbols'],e=Object['prototype']['hasOwnProperty'],d=Object['prototype']['propertyIsEnumerable'],o=(Vj,VA,Vm)=>VA in Vj?q(Vj,VA,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':Vm}):Vj[VA]=Vm,H=(Vj,VA)=>{for(var Vm in VA||(VA={}))e['call'](VA,Vm)&&o(Vj,Vm,VA[Vm]);if(x){for(var Vm of x(VA))d['call'](VA,Vm)&&o(Vj,Vm,VA[Vm]);}return Vj;};class E extends S{constructor(){super(),this['params']={},this['videoSize']={'width':0x780,'height':0x438},this['videoRatio']=this['videoSize']['width']/this['videoSize']['height'],this['optimalSize']=0x400,this['cameraRatio']=this['videoRatio'],this['cameraAngle']=0x3c/0xb4*Math['PI'];}async['process'](Vj,VA){}async['init'](Vj,VA,Vm){return this['params']=Vj,!Vm&&VA&&(Vm=(VA==null?void 0x0:VA['width'])/(VA==null?void 0x0:VA['height'])),this['setupVideo'](VA||this['videoSize'],Vm||this['videoRatio']),this['emit']('init',!0x0),!0x0;}['reset'](){this['emit']('reset');}['dispose'](){}['setupVideo'](Vj,VA){VA=VA||Vj['width']/Vj['height'],this['videoSize']=H({},Vj),this['videoRatio']=VA,this['cameraRatio']=VA;}}class i extends S{constructor(Vj,VA='crop',Vm=0x1,VL=!0x1,Vn=0x1){super(),this['container']=Vj,this['mode']=VA,this['layerCount']=Vm,this['mirror']=VL,this['aspectRatio']=Vn,this['layers']=[],this['padsSize']=[0x1,0x1],this['setAspectRatio']=Vu=>{this['aspectRatio']=Vu,this['updateSizes'](this['container']['clientWidth']/this['container']['clientHeight']);},this['setMirror']=Vu=>{this['mirror']=Vu,this['layers']['forEach'](VX=>{VX['style']['transform']=Vu?'scaleX(-1)':'';});},this['updateSizes']=Vu=>{let VX=0x1,VD=0x1;Vu>this['aspectRatio']?this['mode']==='crop'?VD=Vu/this['aspectRatio']:VX=this['aspectRatio']/Vu:this['mode']==='crop'?VX=this['aspectRatio']/Vu:VD=Vu/this['aspectRatio'];const Vh=(0x1-VX)/0x2,Vv=(0x1-VD)/0x2,Vq=VX*0x64+'%',Vx=VD*0x64+'%',Vp=Vh*0x64+'%',Ve=Vv*0x64+'%';for(const Vd of this['layers'])Vd['style']['width']=Vq,Vd['style']['height']=Vx,Vd['style']['left']=Vp,Vd['style']['top']=Ve;if(this['pads']){this['padsSize']=Vh>0x0?[Vh,0x1]:[0x1,Vv];const Vo=0xa,{clientWidth:VB,clientHeight:VH}=this['container'],VM=[0x2*Vo/VB,0x2*Vo/VH],Vf=(this['padsSize'][0x0]+0x2*VM[0x0])*0x64+'%',VF=(this['padsSize'][0x1]+0x2*VM[0x1])*0x64+'%';this['pads'][0x0]['style']['width']=Vf,this['pads'][0x0]['style']['height']=VF,this['pads'][0x1]['style']['width']=Vf,this['pads'][0x1]['style']['height']=VF;const VQ=-VM[0x0]*0x64+'%',VE=-VM[0x1]*0x64+'%';this['pads'][0x0]['style']['top']=VE,this['pads'][0x1]['style']['bottom']=VE,this['pads'][0x0]['style']['left']='unset',this['pads'][0x0]['style']['right']='unset',this['pads'][0x1]['style']['left']='unset',this['pads'][0x1]['style']['right']='unset',this['pads'][this['mirror']?0x1:0x0]['style']['left']=VQ,this['pads'][this['mirror']?0x0:0x1]['style']['right']=VQ;const VY=Vh>0x0?this['mirror']?'':'scaleX(-1)':'scaleY(-1)\x20'+(this['mirror']?'scaleX(-1)':'');this['pads'][0x0]['style']['transform']=VY,this['pads'][0x1]['style']['transform']=VY;const Vi='blur('+Vo+'px)';this['pads'][0x0]['style']['filter']=Vi,this['pads'][0x1]['style']['filter']=Vi;}this['emit']('resize');},this['handleResize']=Vu=>{if(Vu['length']<0x1)return;const VX=Vu[0x0]['contentRect'];this['updateSizes'](VX['width']/VX['height']);};for(let Vu=0x0;Vu<Vm;Vu++){const VX=document['createElement']('canvas');VX['id']='engeenee.canvas.layer'+Vu,VX['style']['position']='absolute',VX['style']['zIndex']=-0xa*(Vm-Vu)+'',this['mirror']&&(VX['style']['transform']='scaleX(-1)'),this['container']['appendChild'](VX),this['layers']['push'](VX);}if(this['mode']==='pad'){this['pads']=[document['createElement']('canvas'),document['createElement']('canvas')];const VD=-0xa*(this['layerCount']+0x1)+'';for(let Vh=0x0;Vh<0x2;Vh++)this['pads'][Vh]['id']='engeenee.canvas.pad'+Vh,this['pads'][Vh]['style']['position']='absolute',this['pads'][Vh]['style']['zIndex']=VD,this['container']['appendChild'](this['pads'][Vh]);}this['setAspectRatio'](Vn),this['observer']=new ResizeObserver(this['handleResize']),this['observer']['observe'](this['container']),this['container']['style']['overflow']='hidden';}}var z=Object['defineProperty'],R=Object['getOwnPropertySymbols'],r=Object['prototype']['hasOwnProperty'],J=Object['prototype']['propertyIsEnumerable'],V0=(Vj,VA,Vm)=>VA in Vj?z(Vj,VA,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':Vm}):Vj[VA]=Vm,V1=(Vj,VA)=>{for(var Vm in VA||(VA={}))r['call'](VA,Vm)&&V0(Vj,Vm,VA[Vm]);if(R){for(var Vm of R(VA))J['call'](VA,Vm)&&V0(Vj,Vm,VA[Vm]);}return Vj;};class V2 extends S{constructor(){super(),this['loaded']=!0x1,this['videoSize']={'width':0x780,'height':0x438},this['videoRatio']=this['videoSize']['width']/this['videoSize']['height'],this['cameraRatio']=this['videoRatio'],this['cameraAngle']=0x3c/0xb4*Math['PI'];}async['load'](){this['loaded']||(this['loaded']=!0x0,this['emit']('load'));}['unload'](){!this['loaded']||(this['loaded']=!0x1);}async['update'](Vj,VA){!this['loaded']||(this['updateVideo'](VA),this['updateScene'](),this['emit']('render'));}['updateVideo'](Vj){}['updateScene'](){}['dispose'](){this['unload']();}['setupVideo'](Vj,VA){this['videoSize']=V1({},Vj),this['videoRatio']=VA||Vj['width']/Vj['height'],this['emit']('resize',this['videoSize'],this['videoRatio']);}['setupCamera'](Vj,VA){this['cameraRatio']=Vj,this['cameraAngle']=VA;}}class V3 extends V2{constructor(){super(...arguments),this['plugins']=[];}async['load'](){if(!this['loaded'])return await Promise['all'](this['plugins']['map'](Vj=>Vj['load'](this))),super['load']();}['unload'](){this['plugins']['forEach'](Vj=>Vj['unload']()),super['unload']();}async['update'](Vj,VA){if(this['loaded'])return await this['updatePlugins'](Vj,VA),super['update'](Vj,VA);}async['updatePlugins'](Vj,VA){for(let Vm of this['plugins'])Vm['loaded']&&await Vm['update'](Vj,VA);}['dispose'](){this['plugins']['forEach'](Vj=>Vj['dispose']()),this['plugins']=[],super['dispose']();}async['addPlugin'](Vj){this['loaded']&&!Vj['loaded']&&await Vj['load'](this),this['plugins']['push'](Vj);}['removePlugin'](Vj){const {plugins:VA}=this,Vm=VA['indexOf'](Vj);Vm<0x0||(VA[Vm]['dispose'](),VA['splice'](Vm,0x1));}['removeAllPlugins'](){this['plugins']['forEach'](Vj=>Vj['dispose']()),this['plugins']=[];}['setupVideo'](Vj,VA){super['setupVideo'](Vj,VA),this['plugins']['forEach'](Vm=>Vm['setupVideo'](Vj));}}class V4 extends V3{constructor(Vj){super(),this['padCtx']=[null,null],this['setupPadding']=()=>{if(!this['canvas']['pads'])return;const {width:VA,height:Vm}=this['videoSize'],{padsSize:VL}=this['canvas'],Vn=VA*VL[0x0]/(VL[0x0]<0.5?0x1-0x2*VL[0x0]:0x1),Vu=Vm*VL[0x1]/(VL[0x1]<0.5?0x1-0x2*VL[0x1]:0x1);this['canvas']['pads'][0x0]['width']=Vn,this['canvas']['pads'][0x0]['height']=Vu,this['canvas']['pads'][0x1]['width']=Vn,this['canvas']['pads'][0x1]['height']=Vu;},this['canvas']=new i(Vj['container'],Vj['mode'],Vj['layerCount'],Vj['mirror'],Vj['aspectRatio']),this['canvas']['pads']&&(this['padCtx']=[this['canvas']['pads'][0x0]['getContext']('2d'),this['canvas']['pads'][0x1]['getContext']('2d')],this['canvas']['addListener']('resize',this['setupPadding']));}['updateVideo'](Vj){super['updateVideo'](Vj),this['updatePads'](Vj);}['setupVideo'](Vj,VA){super['setupVideo'](Vj,VA),this['canvas']['setAspectRatio'](this['videoRatio']);}['setMirror'](Vj){this['canvas']['setMirror'](Vj);}['updatePads'](Vj){if(!this['padCtx'][0x0]||!this['padCtx'][0x1]||!this['canvas']['pads'])return;const {videoSize:{width:VA,height:Vm}}=this,{width:VL,height:Vn}=this['canvas']['pads'][0x0];this['padCtx'][0x0]['clearRect'](0x0,0x0,VL,Vn),this['padCtx'][0x0]['drawImage'](Vj,0x0,0x0,VL,Vn,0x0,0x0,VL,Vn),this['padCtx'][0x1]['clearRect'](0x0,0x0,VL,Vn),this['padCtx'][0x1]['drawImage'](Vj,VA-VL,Vm-Vn,VL,Vn,0x0,0x0,VL,Vn);}}class V5 extends V4{constructor(Vj){super(Vj),this['videoCtx']=null;const VA=this['canvas']['layers'][0x0];this['videoCtx']=VA['getContext']('2d');}['updateVideo'](Vj){const {videoCtx:VA}=this;if(!VA)return;const {width:Vm,height:VL}=this['videoSize'];VA['clearRect'](0x0,0x0,Vm,VL),VA['drawImage'](Vj,0x0,0x0),super['updateVideo'](Vj);}['setupVideo'](Vj,VA){super['setupVideo'](Vj,VA);const {width:Vm,height:VL}=this['videoSize'];this['canvas']['layers'][0x0]['width']=Vm,this['canvas']['layers'][0x0]['height']=VL;}}class V6{constructor(Vj,VA={'width':0x780,'height':0x438},Vm=!0x1,VL=!0x1){this['gl']=Vj,this['size']=VA,this['grayscale']=Vm,this['linear']=VL,this['buffer']=null,this['resize'](VA);}['update'](Vj){const {gl:VA,size:{width:Vm,height:VL}}=this,Vn=VA['getParameter'](VA['TEXTURE_BINDING_2D']),Vu=VA['getParameter'](VA['UNPACK_FLIP_Y_WEBGL']);VA['bindTexture'](VA['TEXTURE_2D'],this['buffer']),VA['pixelStorei'](VA['UNPACK_FLIP_Y_WEBGL'],!0x1),Vj instanceof Uint8Array?VA['texSubImage2D'](VA['TEXTURE_2D'],0x0,0x0,0x0,Vm,VL,this['grayscale']?VA['RED']:VA['RGBA'],VA['UNSIGNED_BYTE'],Vj):VA['texSubImage2D'](VA['TEXTURE_2D'],0x0,0x0,0x0,Vm,VL,this['grayscale']?VA['RED']:VA['RGBA'],VA['UNSIGNED_BYTE'],Vj),VA['bindTexture'](VA['TEXTURE_2D'],Vn),VA['pixelStorei'](VA['UNPACK_FLIP_Y_WEBGL'],Vu);}['resize'](Vj){if(Vj['width']===this['size']['width']&&Vj['height']===this['size']['height']&&this['buffer'])return!0x0;const {gl:VA}=this;if(VA['deleteTexture'](this['buffer']),this['buffer']=null,(Vj['width']>0x0||Vj['height']>0x0)&&(this['buffer']=VA['createTexture']()),!this['buffer'])return!0x1;const Vm=this['linear']?VA['LINEAR']:VA['NEAREST'],VL=VA['getParameter'](VA['TEXTURE_BINDING_2D']),Vn=VA['getParameter'](VA['UNPACK_FLIP_Y_WEBGL']);return VA['bindTexture'](VA['TEXTURE_2D'],this['buffer']),VA['pixelStorei'](VA['UNPACK_FLIP_Y_WEBGL'],!0x1),VA['texParameteri'](VA['TEXTURE_2D'],VA['TEXTURE_WRAP_S'],VA['CLAMP_TO_EDGE']),VA['texParameteri'](VA['TEXTURE_2D'],VA['TEXTURE_WRAP_T'],VA['CLAMP_TO_EDGE']),VA['texParameteri'](VA['TEXTURE_2D'],VA['TEXTURE_MIN_FILTER'],Vm),VA['texParameteri'](VA['TEXTURE_2D'],VA['TEXTURE_MAG_FILTER'],Vm),this['size']={'width':Vj['width'],'height':Vj['height']},VA['texStorage2D'](VA['TEXTURE_2D'],0x1,this['grayscale']?VA['R8']:VA['RGBA8'],Vj['width'],Vj['height']),VA['bindTexture'](VA['TEXTURE_2D'],VL),VA['pixelStorei'](VA['UNPACK_FLIP_Y_WEBGL'],Vn),!0x0;}['dispose'](){this['gl']['deleteTexture'](this['buffer']),this['buffer']=null;}['texture'](){return this['buffer'];}['valid'](){return!!this['buffer'];}}var V7=Object['defineProperty'],V8=Object['getOwnPropertySymbols'],V9=Object['prototype']['hasOwnProperty'],VV=Object['prototype']['propertyIsEnumerable'],VK=(Vj,VA,Vm)=>VA in Vj?V7(Vj,VA,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':Vm}):Vj[VA]=Vm,VS=(Vj,VA)=>{for(var Vm in VA||(VA={}))V9['call'](VA,Vm)&&VK(Vj,Vm,VA[Vm]);if(V8){for(var Vm of V8(VA))VV['call'](VA,Vm)&&VK(Vj,Vm,VA[Vm]);}return Vj;};class Vt{constructor(Vj,VA={'width':0x780,'height':0x438},Vm=['image'],VL={'size':'2f','flip':'1f'},Vn=VN,Vu=VW,VX=!0x1){this['gl']=Vj,this['size']=VA,this['inputs']=Vm,this['uniforms']=VL,this['vertShader']=null,this['fragShader']=null,this['shaderProgram']=null,this['vertBuffer']=null,this['frameBuffer']=null,this['uniformsLoc']={},this['positionLoc']=0x0,this['output']=new V6(Vj,VA,!0x1,VX),this['compile'](Vn,Vu),this['resize'](VA);}['process'](Vj,VA={}){const {gl:Vm,output:VL}=this;if(!Vm||!VL||Vj['length']!==this['inputs']['length'])return;const Vn=this['save'](Vm);Vm['bindFramebuffer'](Vm['FRAMEBUFFER'],this['frameBuffer']),Vm['framebufferTexture2D'](Vm['FRAMEBUFFER'],Vm['COLOR_ATTACHMENT0'],Vm['TEXTURE_2D'],VL['texture'](),0x0),VA=VS({'flip':[-0x1]},VA),this['prepare'](Vm,Vj,VA),Vm['drawArrays'](Vm['TRIANGLES'],0x0,0x6),this['restore'](Vm,Vn);}['render'](Vj,VA={}){const {gl:Vm,output:VL}=this;if(!Vm||!VL||Vj['length']!==this['inputs']['length'])return;const Vn=this['save'](Vm);Vm['bindFramebuffer'](Vm['FRAMEBUFFER'],null),VA=VS({'flip':[0x1]},VA),this['prepare'](Vm,Vj,VA),Vm['drawArrays'](Vm['TRIANGLES'],0x0,0x6),this['restore'](Vm,Vn);}['resize'](Vj){var VA;const {gl:Vm}=this;this['size']={'width':Vj['width'],'height':Vj['height']},(VA=this['output'])==null||VA['resize'](Vj);const VL=Vm['getParameter'](Vm['CURRENT_PROGRAM']);Vm['useProgram'](this['shaderProgram']),this['uniformsLoc']['size']&&Vm['uniform2f'](this['uniformsLoc']['size'],Vj['width'],Vj['height']),Vm['useProgram'](VL);}['dispose'](){var Vj;const {gl:VA}=this;VA['deleteBuffer'](this['vertBuffer']),this['vertBuffer']=null,VA['deleteFramebuffer'](this['frameBuffer']),this['frameBuffer']=null,VA['deleteShader'](this['vertShader']),this['vertShader']=null,VA['deleteShader'](this['fragShader']),this['fragShader']=null,VA['deleteProgram'](this['shaderProgram']),this['shaderProgram']=null,(Vj=this['output'])==null||Vj['dispose'](),delete this['output'];}['program'](){return this['shaderProgram'];}['compile'](Vj,VA){const {gl:Vm}=this,VL=this['save'](Vm);if(this['vertBuffer']=Vm['createBuffer'](),this['frameBuffer']=Vm['createFramebuffer'](),!this['vertBuffer']||!this['frameBuffer']){Vm['deleteBuffer'](this['vertBuffer']),this['vertBuffer']=null,Vm['deleteFramebuffer'](this['frameBuffer']),this['frameBuffer']=null;return;}if(Vm['bindVertexArray'](null),Vm['bindBuffer'](Vm['ARRAY_BUFFER'],this['vertBuffer']),Vm['bufferData'](Vm['ARRAY_BUFFER'],new Float32Array([-0x1,-0x1,0x1,0x1,-0x1,0x1,-0x1,-0x1,0x1,-0x1,0x1,0x1]),Vm['STATIC_DRAW']),this['vertShader']=Vm['createShader'](Vm['VERTEX_SHADER']),this['fragShader']=Vm['createShader'](Vm['FRAGMENT_SHADER']),this['shaderProgram']=Vm['createProgram'](),!this['vertShader']||!this['fragShader']||!this['shaderProgram']){Vm['deleteBuffer'](this['vertBuffer']),this['vertBuffer']=null,Vm['deleteFramebuffer'](this['frameBuffer']),this['frameBuffer']=null,Vm['deleteShader'](this['vertShader']),this['vertShader']=null,Vm['deleteShader'](this['fragShader']),this['fragShader']=null,Vm['deleteProgram'](this['shaderProgram']),this['shaderProgram']=null;return;}Vm['shaderSource'](this['vertShader'],VA),Vm['shaderSource'](this['fragShader'],Vj),Vm['compileShader'](this['vertShader']),Vm['compileShader'](this['fragShader']),Vm['attachShader'](this['shaderProgram'],this['vertShader']),Vm['attachShader'](this['shaderProgram'],this['fragShader']),Vm['linkProgram'](this['shaderProgram']),Vm['useProgram'](this['shaderProgram']),this['positionLoc']=Vm['getAttribLocation'](this['shaderProgram'],'position'),Vm['vertexAttribPointer'](this['positionLoc'],0x2,Vm['FLOAT'],!0x1,0x0,0x0),Vm['enableVertexAttribArray'](this['positionLoc']),this['uniformsLoc']={};for(let Vn in this['uniforms'])this['uniformsLoc'][Vn]=Vm['getUniformLocation'](this['shaderProgram'],Vn);for(let Vu=0x0;Vu<this['inputs']['length'];Vu++)Vm['uniform1i'](Vm['getUniformLocation'](this['shaderProgram'],this['inputs'][Vu]),Vu);this['restore'](Vm,VL);}['prepare'](Vj,VA,Vm={}){const {size:{width:VL,height:Vn}}=this;for(let Vu=0x0;Vu<VA['length'];Vu++)Vj['activeTexture'](Vj['TEXTURE0']+Vu),Vj['bindTexture'](Vj['TEXTURE_2D'],VA[Vu]);Vj['useProgram'](this['shaderProgram']),Vj['bindVertexArray'](null),Vj['bindBuffer'](Vj['ARRAY_BUFFER'],this['vertBuffer']),Vj['vertexAttribPointer'](this['positionLoc'],0x2,Vj['FLOAT'],!0x1,0x0,0x0),Vj['enableVertexAttribArray'](this['positionLoc']),Vj['disable'](Vj['CULL_FACE']);for(let VX in Vm)switch(this['uniforms'][VX]){case'1f':this['uniformsLoc'][VX]&&Vm[VX]['length']===0x1&&Vj['uniform1f'](this['uniformsLoc'][VX],Vm[VX][0x0]);break;case'2f':this['uniformsLoc'][VX]&&Vm[VX]['length']===0x2&&Vj['uniform2f'](this['uniformsLoc'][VX],Vm[VX][0x0],Vm[VX][0x1]);break;case'3f':this['uniformsLoc'][VX]&&Vm[VX]['length']===0x3&&Vj['uniform3f'](this['uniformsLoc'][VX],Vm[VX][0x0],Vm[VX][0x1],Vm[VX][0x2]);break;case'4f':this['uniformsLoc'][VX]&&Vm[VX]['length']===0x4&&Vj['uniform4f'](this['uniformsLoc'][VX],Vm[VX][0x0],Vm[VX][0x1],Vm[VX][0x2],Vm[VX][0x3]);break;}Vj['viewport'](0x0,0x0,VL,Vn),Vj['scissor'](0x0,0x0,VL,Vn);}['save'](Vj){return{'program':Vj['getParameter'](Vj['CURRENT_PROGRAM']),'arrayBuffer':Vj['getParameter'](Vj['ARRAY_BUFFER_BINDING']),'framebuffer':Vj['getParameter'](Vj['FRAMEBUFFER_BINDING']),'vertexArray':Vj['getParameter'](Vj['VERTEX_ARRAY_BINDING']),'viewport':Vj['getParameter'](Vj['VIEWPORT']),'scissor':Vj['getParameter'](Vj['SCISSOR_BOX']),'cullFace':Vj['getParameter'](Vj['CULL_FACE']),'activeTexture':Vj['getParameter'](Vj['ACTIVE_TEXTURE']),'textures':this['inputs']['map']((VA,Vm)=>(Vj['activeTexture'](Vj['TEXTURE0']+Vm),Vj['getParameter'](Vj['TEXTURE_BINDING_2D'])))};}['restore'](Vj,VA){Vj['useProgram'](VA['program']),Vj['bindBuffer'](Vj['ARRAY_BUFFER'],VA['arrayBuffer']),Vj['bindFramebuffer'](Vj['FRAMEBUFFER'],VA['framebuffer']),Vj['bindVertexArray'](VA['vertexArray']),Vj['viewport'](VA['viewport'][0x0],VA['viewport'][0x1],VA['viewport'][0x2],VA['viewport'][0x3]),Vj['scissor'](VA['scissor'][0x0],VA['scissor'][0x1],VA['scissor'][0x2],VA['scissor'][0x3]);for(let Vm=0x0;Vm<VA['textures']['length'];Vm++)Vj['activeTexture'](Vj['TEXTURE0']+Vm),Vj['bindTexture'](Vj['TEXTURE_2D'],VA['textures'][Vm]);Vj['activeTexture'](VA['activeTexture']),VA['cullFace']?Vj['enable'](Vj['CULL_FACE']):Vj['disable'](Vj['CULL_FACE']);}}const VW='\x0a\x20\x20\x20\x20attribute\x20vec2\x20position;\x0a\x20\x20\x20\x20varying\x20vec2\x20coords;\x0a\x20\x20\x20\x20uniform\x20float\x20flip;\x0a\x20\x20\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20coords\x20=\x20(vec2(position.x,\x20-position.y)\x20+\x201.0)\x20*\x200.5;\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20vec4(position.x,\x20position.y\x20*\x20flip,\x200,\x201.0);\x0a\x20\x20\x20\x20}\x0a',VN='\x0a\x20\x20\x20\x20precision\x20mediump\x20float;\x0a\x20\x20\x20\x20varying\x20vec2\x20coords;\x0a\x20\x20\x20\x20uniform\x20vec2\x20size;\x0a\x20\x20\x20\x20uniform\x20sampler2D\x20image;\x0a\x20\x20\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20texture2D(image,\x20coords);\x0a\x20\x20\x20\x20}\x0a';class VT extends V4{constructor(Vj){super(Vj),this['shaderCtx']=null,this['current']=null;const VA=this['canvas']['layers'][0x0];this['shaderCtx']=VA['getContext']('webgl2',{'alpha':!0x0,'preserveDrawingBuffer':!0x0});}async['load'](){const {shaderCtx:Vj,videoSize:VA}=this;if(Vj)return this['shader']=new Vt(Vj,VA),this['input']=new V6(Vj,VA),super['load']();}['unload'](){var Vj,VA;(Vj=this['input'])==null||Vj['dispose'](),delete this['input'],(VA=this['shader'])==null||VA['dispose'](),delete this['shader'],super['unload']();}async['update'](Vj,VA){if(!this['loaded'])return;const {input:Vm}=this,VL=Vm==null?void 0x0:Vm['texture']();if(!(!Vm||!VL))return Vm==null||Vm['update'](VA),this['current']=VL,super['update'](Vj,VA);}['updateVideo'](Vj){!this['shader']||(this['shader']['render']([this['current']]),super['updateVideo'](Vj));}['setupVideo'](Vj,VA){var Vm,VL;super['setupVideo'](Vj,VA);const {width:Vn,height:Vu}=this['videoSize'];this['canvas']['layers'][0x0]['width']=Vn,this['canvas']['layers'][0x0]['height']=Vu,(Vm=this['input'])==null||Vm['resize']({'width':Vn,'height':Vu}),(VL=this['shader'])==null||VL['resize']({'width':Vn,'height':Vu});}}class VG extends VT{['dispose'](){delete this['scene'],super['dispose']();}}class Vc{constructor(){this['loaded']=!0x1;}async['load'](Vj){this['loaded']||(this['renderer']=Vj,this['loaded']=!0x0);}['unload'](){!this['loaded']||(this['loaded']=!0x1);}async['update'](Vj,VA){this['loaded'];}['dispose'](){this['unload']();}['setupVideo'](Vj){}}class VU extends Vc{async['load'](Vj){if(!(this['loaded']||!(Vj instanceof V5)||!Vj['videoCtx']))return this['videoCtx']=Vj['videoCtx'],super['load'](Vj);}['unload'](){!this['loaded']||(delete this['videoCtx'],super['unload']());}}var Vb=Object['defineProperty'],Vs=Object['getOwnPropertySymbols'],Vl=Object['prototype']['hasOwnProperty'],Vg=Object['prototype']['propertyIsEnumerable'],VP=(Vj,VA,Vm)=>VA in Vj?Vb(Vj,VA,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':Vm}):Vj[VA]=Vm,Va=(Vj,VA)=>{for(var Vm in VA||(VA={}))Vl['call'](VA,Vm)&&VP(Vj,Vm,VA[Vm]);if(Vs){for(var Vm of Vs(VA))Vg['call'](VA,Vm)&&VP(Vj,Vm,VA[Vm]);}return Vj;};class VO extends Vc{constructor(Vj,VA,Vm,VL){super(),this['inputs']=Vj,this['uniforms']=VA,this['fragSrc']=Vm,this['vertSrc']=VL,this['size']={'width':0x0,'height':0x0};}async['load'](Vj){if(!(this['loaded']||!(Vj instanceof VT)||!Vj['shaderCtx']))return this['shader']=new Vt(Vj['shaderCtx'],this['size'],this['inputs'],this['uniforms'],this['fragSrc'],this['vertSrc']),super['load'](Vj);}['unload'](){var Vj;!this['loaded']||((Vj=this['shader'])==null||Vj['dispose'](),delete this['shader'],super['unload']());}async['update'](Vj,VA){var Vm,VL;const {renderer:Vn}=this;if(!this['loaded']||!(Vn instanceof VT)||!Vn['current'])return;const Vu=this['process'](Vj,Vn['current'])&&((VL=(Vm=this['shader'])==null?void 0x0:Vm['output'])==null?void 0x0:VL['texture']());Vu&&(Vn['current']=Vu);}['process'](Vj,VA){var Vm;return(Vm=this['shader'])==null||Vm['process']([VA]),!0x0;}['setupVideo'](Vj){var VA;this['size']=Va({},Vj),(VA=this['shader'])==null||VA['resize'](Vj);}}class Vk extends Vc{async['load'](Vj){if(!(this['loaded']||!(Vj instanceof VG)||!Vj['scene']))return this['scene']=Vj['scene'],super['load'](Vj);}['unload'](){!this['loaded']||(delete this['scene'],super['unload']());}}class Vw{constructor(Vj,VA=!0x1,Vm='video',VL){this['renderer']=Vj,this['mirror']=VA,this['sizeMode']=Vm,this['sizeMax']=VL;}async['snapshot'](){return new Promise(Vj=>{this['renderer']['once']('render',()=>{const {renderer:VA}=this,{layers:Vm}=VA['canvas'];let {width:VL,height:Vn}=VA['canvas']['layers'][0x0];this['sizeMode']==='max'?(VL=Math['max'](...Vm['map'](Vh=>Vh['width'])),Vn=Math['max'](...Vm['map'](Vh=>Vh['height']))):this['sizeMode']==='min'&&(VL=Math['min'](...Vm['map'](Vh=>Vh['width'])),Vn=Math['min'](...Vm['map'](Vh=>Vh['height'])));const Vu=document['createElement']('canvas');Vu['id']='engeenee.snapshot',Vu['hidden']=!0x0,Vu['width']=VL,Vu['height']=Vn;const VX=Vu['getContext']('2d',{'alpha':!0x0});if(!VX)return;this['mirror']&&(VX['translate'](VL,0x0),VX['scale'](-0x1,0x1)),Vm['forEach'](Vh=>VX['drawImage'](Vh,0x0,0x0,VL,Vn));const VD=VX['getImageData'](0x0,0x0,VL,Vn);Vu['remove'](),Vj(VD);});});}async['snapshotLayers'](){return new Promise(Vj=>{this['renderer']['once']('render',()=>{const VA=document['createElement']('canvas');VA['id']='engeenee.snapshot',VA['hidden']=!0x0;const Vm=VA['getContext']('2d',{'alpha':!0x0});if(!Vm)return;const VL=this['renderer']['canvas']['layers']['map'](Vn=>{const {width:Vu,height:VX}=Vn;return VA['width']=Vu,VA['height']=VX,Vm['resetTransform'](),this['mirror']&&(Vm['translate'](Vu,0x0),Vm['scale'](-0x1,0x1)),Vm['drawImage'](Vn,0x0,0x0),Vm['getImageData'](0x0,0x0,Vu,VX);});VA['remove'](),Vj(VL);});});}}class Vy{constructor(Vj,VA='video/webm',Vm=!0x1,VL='video',Vn,Vu){this['renderer']=Vj,this['type']=VA,this['mirror']=Vm,this['sizeMode']=VL,this['sizeMax']=Vn,this['bitRate']=Vu,this['context']=null,this['records']=[],this['canvas']=document['createElement']('canvas'),this['canvas']['id']='engeenee.record',this['canvas']['hidden']=!0x0,this['context']=this['canvas']['getContext']('2d',{'alpha':!0x1});}['start'](){const {canvas:Vj,context:VA,renderer:Vm}=this;if(!Vj||!VA)return!0x1;const {layers:VL}=Vm['canvas'];let {width:Vn,height:Vu}=VL[0x0];this['sizeMode']==='max'?(Vn=Math['max'](...VL['map'](VD=>VD['width'])),Vu=Math['max'](...VL['map'](VD=>VD['height']))):this['sizeMode']==='min'&&(Vn=Math['min'](...VL['map'](VD=>VD['width'])),Vu=Math['min'](...VL['map'](VD=>VD['height'])));const VX=Math['max'](Vn,Vu);if(this['sizeMax']&&VX>this['sizeMax']){const VD=this['sizeMax']/VX;Vn*=VD,Vu*=VD;}return Vj['width']=Vn,Vj['height']=Vu,VA['resetTransform'](),this['mirror']&&(VA['translate'](Vn,0x0),VA['scale'](-0x1,0x1)),Vm['on']('render',this['frame']),this['records']=[],this['stream']=Vj['captureStream'](0x0),this['recorder']=new MediaRecorder(this['stream'],{'mimeType':this['type'],'videoBitsPerSecond':this['bitRate']}),this['recorder']['ondataavailable']=Vh=>this['records']['push'](Vh['data']),this['recorder']['start'](),!0x0;}async['stop'](){const {recorder:Vj}=this;if(!(!Vj||Vj['state']!='recording'))return new Promise(VA=>{Vj['onstop']=()=>{var Vm;VA(new Blob(this['records'],{'type':this['type']})),this['records']=[],(Vm=this['stream'])==null||Vm['getVideoTracks']()['forEach'](VL=>VL['stop']()),this['renderer']['removeListener']('render',()=>this['frame']()),delete this['stream'],delete this['recorder'];},Vj['stop']();});}['dispose'](){this['canvas']['remove']();}['frame'](){var Vj;const {renderer:VA,context:Vm,stream:VL}=this,{width:Vn,height:Vu}=this['canvas'];!VL||!Vm||(VA['canvas']['layers']['map'](VX=>Vm['drawImage'](VX,0x0,0x0,Vn,Vu)),(Vj=VL['getVideoTracks']()[0x0])==null||Vj['requestFrame']());}}class VI{constructor(Vj,VA=!0x1,Vm='video',VL){this['renderer']=Vj,this['mirror']=VA,this['sizeMode']=Vm,this['sizeMax']=VL,this['context']=null,this['render']=()=>{const {canvas:Vn,context:Vu}=this;!Vn||!Vu||this['renderer']['canvas']['layers']['map'](VX=>Vu['drawImage'](VX,0x0,0x0,Vn['width'],Vn['height']));},this['canvas']=document['createElement']('canvas'),this['canvas']['id']='engeenee.record',this['canvas']['hidden']=!0x0,this['mirror']&&(this['canvas']['style']['transform']='scaleX(-1)'),this['context']=this['canvas']['getContext']('2d',{'alpha':!0x1});}['start'](){const {canvas:Vj,context:VA,renderer:Vm}=this;if(!Vj||!VA)return!0x1;const {layers:VL}=Vm['canvas'];let {width:Vn,height:Vu}=VL[0x0];this['sizeMode']==='max'?(Vn=Math['max'](...VL['map'](VD=>VD['width'])),Vu=Math['max'](...VL['map'](VD=>VD['height']))):this['sizeMode']==='min'&&(Vn=Math['min'](...VL['map'](VD=>VD['width'])),Vu=Math['min'](...VL['map'](VD=>VD['height'])));const VX=Math['max'](Vn,Vu);if(this['sizeMax']&&VX>this['sizeMax']){const VD=this['sizeMax']/VX;Vn*=VD,Vu*=VD;}return Vj['width']=Vn,Vj['height']=Vu,VA['resetTransform'](),this['mirror']&&(VA['translate'](Vn,0x0),VA['scale'](-0x1,0x1)),this['renderer']['on']('render',this['render']),this['stream']=Vj['captureStream'](),!0x0;}['pause'](){this['renderer']['removeListener']('render',this['render']);}['mediaStream'](){return this['stream'];}}export{h as AsyncEngine,V4 as CanvasRenderer,n as Engine,S as EventEmitterT,a as ImageBuffer,V6 as ImageTexture,Vc as Plugin,V3 as PluginRenderer,E as Processor,Vy as Recorder,V2 as Renderer,i as ResponsiveCanvas,Vk as ScenePlugin,VG as SceneRenderer,VO as ShaderPlugin,Vt as ShaderProgram,VT as ShaderRenderer,Vw as Snapshoter,VI as Streamer,w as VideoCapture,VU as VideoPlugin,V5 as VideoRenderer,k as VideoSource};
